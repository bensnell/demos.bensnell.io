<!DOCTYPE html>
<html lang="">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<head>  
  <title>tied up, tied down, let loose, unwound</title>
  <style>
    body {
      background: #FFF;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      margin: 0
    }
    canvas {
      margin: auto;
      display: block;
    }
    body.dark-theme {
      background: #000;
    }
  </style>
</head>

<body>
  <script>
    // Turn on dark color scheme if preferred by user.
    // https://css-tricks.com/a-complete-guide-to-dark-mode-on-the-web/
    const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
    if (prefersDarkScheme.matches) {
      document.body.classList.add("dark-theme");
    } else {
      document.body.classList.remove("dark-theme");
    }
  </script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r124/three.min.js"></script>
  <script>
    //TOKEN_DATA_BEGIN//
function random_hash() {
  let x = "0123456789abcdef", hash = '0x'
  for (let i = 64; i > 0; --i) {
    hash += x[Math.floor(Math.random() * x.length)]
  }
  return hash;
};

if (!this.tokenData) this.tokenData = {};
//INSERT_USER_TOKEN_DATA//
if (!('tokenId' in tokenData)) tokenData.tokenId = "123000456";
if (!('hash' in tokenData)) tokenData.hash = random_hash();    
    //TOKEN_DATA_END//
  </script>
  <script>
    // If the hash is passed as a url parameter, then set it.
    // https://www.sitepoint.com/get-url-parameters-with-javascript/
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has("hash")) tokenData.hash = urlParams.get("hash");
  </script>
  <script>
    // Add License Here

    //APP_BEGIN//
var META="Ben Snell_tied up, tied down, let loose, unwound_1.2.3";const e=(()=>{try{return new TIMESAMPLE}catch{return null}})();class r{constructor(e){this.t=e,this.i=[0,8,16,24].map(t=>parseInt(e.substr(t,8),16)),this.h()}h(){this.data=[...this.i]}u(){var t=this.data,e=(t[0]|=0,t[1]|=0,t[2]|=0,t[3]|=0,(t[0]+t[1]|0)+t[3]|0);return t[3]=t[3]+1|0,t[0]=t[1]^t[1]>>>9,t[1]=t[2]+(t[2]<<3)|0,t[2]=t[2]<<21|t[2]>>>11,t[2]=t[2]+e|0,(e>>>0)/4294967296}clone(){var t=new r(this.t);return t.data=[...this.data],t}}class i{constructor(){this.o=!1,[this.l,this.v]=[2,34].map(t=>new r(tokenData.hash.substr(t,32))),this.M()}h(){return this.o=!1,this.l.h(),this.v.h(),this.M(),this}M(){for(let t=0;t<5e5;t+=1)this.step();return this}step(e=1){for(let t=0;t<e;t++)this.l.u(),this.v.u();return this}d(){return this.o=!this.o,(this.o?this.l:this.v).u()}n(t,e){return t+(e-t)*this.d()}m(t,e){return Math.floor(this.n(t,e+1))}g(t=0,e=1,r=1,i=1){let s=0,n=0;for(;0===s;)s=this.d();for(;0===n;)n=this.d();var h=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*n);return h*[0<h?i:r]*e+t}c(i,s,n=1){if(0==i.length)return null;if(null!=n&&(n=_(n,0,Number.MAX_SAFE_INTEGER)),null==s||s.length!=i.length)return i[Math.max(Math.min(Math.floor(this.d()**n*i.length),i.length-1),0)];{let r=[],e=(s.reduce((t,e)=>(t+=e,r.push(t),t),0),r[r.length-1]);r=r.map(t=>t/e);var h=this.d()**n;let t=0;for(;t<=r.length-1&&h>r[t];)t++;return i[t]}}p(){var t=new i;return t.o=this.o,t.l=this.l.clone(),t.v=this.v.clone(),t}N(t){var e=t.toString();let r=0;for(let t=0;t<e.length;t++)r+=e.charCodeAt(t)*31**t;return r%=1e6,this.h().step(r)}}const N=new i;var n=(t,e)=>{let r,i,s=(t=e?t:t.slice()).length;for(;1<s;)r=N.d()*s|0,i=t[--s],t[s]=t[r],t[r]=i;return t},_=(t,e=0,r=1)=>(r<e&&([e,r]=[r,e]),Math.max(Math.min(t,r),e)),h=(...t)=>[Math.min(...t),Math.max(...t)],u=(t,e)=>(t+Math.ceil(Math.abs(t/e))*e)%e,V=(t,e)=>(t||e)&&!(t&&e),s=(t,e,r)=>(t=u(t,r),e=u(e,r),[c,d]=h(t,e),[(q=d-c>r/2)?d-r:c,q?c:d,V(t==d,q)]),z=(t,e,r,i)=>([c,d,f]=s(t,e,i),u(L(c,d,f?1-r:r),i)),o=(t,e,r)=>([c,d,f]=s(t,e,r),(c-d)*(f?-1:1)),B=(t,e,r)=>u(o(t,e,r),r),v=(t,e,r)=>Math.abs(o(t,e,r)),j=(t,i,s)=>u(Z(Math.atan2(...[Math.sin,Math.cos].map(r=>t.map((t,e)=>r(u(t,i)/i*2*Math.PI)*(s?s[e]:1))._()/t.length/(s?s._():t.length)))),2*Math.PI)/2/Math.PI*i,S=(...t)=>{var e,r=(t=t&&0<t.length&&Array.isArray(t[0])?t[0]:t).length;let i=[[]];for(;0<t.length;)i=(e=t.pop(),Array(e).fill(0).map((t,e)=>e).map(e=>i.map(t=>[e].concat(t))).flat());return r<=1?i.flat():i},O=(t,e,r)=>[t[e],t[r]]=[t[r],t[e]],G=(t,e)=>{let i=t=>{return s((e=t)instanceof Function?e:JSON.parse(JSON.stringify(e)),t);var e},s=(r,t)=>(r instanceof Object&&t instanceof Object&&Object.entries(t).map(([t,e])=>{s(r[t],e),null==r[t]&&(r[t]=i(e))}),r);return s(i(t),e)},Z=(t,e=0)=>Number.isNaN(t)?e:t,J=(t,e)=>(t+Math.abs(Math.floor(t/e))*e)%e,M=(t,e)=>e<Number.EPSILON?0:t/e,Y=(t,e,r=null)=>(null==r&&(r=e,e=t[1],t=t[0]),r*(e-t)+t),X=(t,e,r=1)=>Math.pow(_(1-e-Math.cos(Math.PI/2*(t+e))),e?1/r:r),K=(t,e)=>[e].A().S((t,e)=>t[e],t),Q=(Array.prototype.at=function(t){var e=this.length;return 0==e?null:this[u(parseInt(t),e)]},Array.prototype.P=function(){let r=[];return this.S((t,e)=>(r.push(t+e),t+e)),r},Array.prototype.W=function(t){var e=this;let r=0;for(var i=e.length;r+2<i&&e[r+1]<t;)r++;return i<2?0:r+_((t-e[r])/(e[r+1]-e[r]))},Array.prototype.C=function(t,e=1){t=[0].concat(this.map(t=>[t/2,t/2]).flat()).P().W(this.P().at(-1)*t);return(parseInt(t)+SZ(t%1,1-int(t)%2,e)-1)/2},Array.prototype._=function(){return this.S((t,e)=>t+e)},Array.prototype.A=function(t=Number.POSITIVE_INFINITY){let e=this;for(;t--&&e.some(t=>t instanceof Array);)e=e.flat();return e},Array.prototype.I=function(r,i=1){return this.sort((t,e)=>K(i?t:e,r)-K(i?e:t,r))},Array.prototype.S=function(t,e=0){return this.reduce(t,e)},Array.prototype.k=function(){return this.sort(function(t,e){return t===1/0?1:isNaN(t)?-1:t-e})},Array.prototype.F=function(e,r=!1){e=u(e,this.length);for(let t=0;t<e;t++)r?this.unshift(this.pop()):this.push(this.shift());return this},Array.prototype.L=function(r){var t=[...this].map((t,e)=>[t,e]).sort((t,e)=>r(t[0],e[0])).at(0);return t&&t[1]},Array.prototype.T=function(){return this.L((t,e)=>e-t)},Array.prototype.H=function(){return this.L((t,e)=>t-e)},Array.prototype.min=function(){return Math.min(...this)},Array.prototype.max=function(){return Math.max(...this)},Array.prototype.R=function(...t){return(t=t.flat()).map(t=>Array.isArray(t)?this.R(t):this.at(t))},(r,t=0)=>("string"==typeof r?S(r.length).S((t,e)=>t+r.charCodeAt(e)*31**e):r)*31**t),U=(t,e)=>Math.pow(Math.abs(t),e)*Math.sign(t),$=(t,e=10)=>Math.log(t)/Math.log(e),x=(t,e,r=1,i=0,s=1,n=!0)=>{t=(t-e)/(r-e)*(s-i)+i;return n?_(t,...h(i,s)):t},tt=r=>r&&r[0]instanceof Array?r[0].map((t,e)=>r.map(t=>t[e])):r,m=(t,e=0,r=1)=>(a=x(t,e,r,0,1))<=0?0:1<=a?1:(1-Math.cos(Math.PI*a))/2,et=(t,e,r,i,s,n,h,a)=>{r=$(.5,x(r,e,i,0,1,!0)),n=$(x(n,s,h,0,1,!0),.5),t=U(U(x(t,e,i,0,1,a),r),n);return x(t,0,1,s,h,a)},rt=r=>r.flatMap((e,t)=>r.slice(t+1).map(t=>[e,t])),featureSeeds=(()=>{var t=N.p().h().step(1e4),e=(t.N("Network"),t.c(...tt([[2,.002],[3,.004],[4,.01],[5,.02],[6,.04],[7,.06],[8,.08],[9,.1],[10,.11],[11,.11],[12,.11],[13,.1],[14,.09],[15,.07],[16,.05],[17,.03],[18,.01]])));t.N("Shape Mode");let r=[{name:"Classic",D:1.15,V:{B:1,j:0,O:3},q:{G:1,Z:0,O:3}},{name:"Twist",D:1.3,V:{B:-1,j:0,O:[[.5,0],[3.5,(e-2)/2]]},q:{G:1,Z:0,O:3}},{name:"Links",D:1.3,V:{B:1,j:0,O:3},q:{G:0,Z:1,O:1/0}},{name:"Continuous",D:1.15,V:{B:1,j:.25,O:4},q:{G:1,Z:-2,O:1/0}}],i={J:t.c(...tt([[[0,0],.8],[[0,1],.55],[[0,2],.55],[[0,3],0],[[1,0],.1],[[1,1],.35],[[1,2],1.8],[[1,3],.35],[[2,0],.3],[[2,1],.5],[[2,2],1],[[2,3],0],[[3,0],0],[[3,1],.1],[[3,2],.2],[[3,3],0]]))};t.N("Cords");var[s,n,h]=t.c([[1.5,1.05,"Extra Thick"],[1.25,1.15,"Thick"],[1,1.2,"Normal"],[.75,1.4,"Thin"]],[0,0,3,0]),[a,u]=(s*=1.8,t.d(),t.N("Foreground Color"),t.c([[[.9,0,.25],"Red"],[[1,.8,.3],"Yellow"],[[.4,.4,.9],"Blue"],[[0,.6,.4],"Green"]],[1,1,1,.35])),[o,l]=t.c("Green"==u?[[[0,.6,.4],"Green"]]:[[[.9,0,.25],"Red"],[[1,.8,.3],"Yellow"],[[.4,.4,.9],"Blue"]],[1,1,1]),c=(t.N("Background Color"),t.c([[245/255,245/255,220/255]])),[t,f]=(t.N("Handedness"),t.c([[0,"Right"],[1,"Left"]]));return{Y:e,X:s,K:h,U:!1,$:n,tt:a,et:u,backgroundColor:c,rt:o,it:l,st:[.1,0,0],nt:t=>{t=_(Math.floor(t*i.J.length),0,i.J.length-1),t=i.J[t];return r[t]},ht:.085,handedness:t,ut:f}})();class A{constructor(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}get ot(){return[this.x,this.y]}get lt(){return[this.x,this.z]}get ct(){return[this.y,this.z]}get ft(){return[this.x,this.y,this.z]}set(t,e,r){return t instanceof A?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):t instanceof Array?(this.x=t[0]||0,this.y=t[1]||0,this.z=t[2]||0):(this.x=t||0,this.y=e||0,this.z=r||0),this}vt(e=null){return e?new A(...S(Math.min(e.length,3)).map(t=>{switch(e[t]){case"x":case"X":return this.x;case"y":case"Y":return this.y;case"z":case"Z":return this.z;default:return 0}})):new A(this.x,this.y,this.z)}clone(){return this.vt()}dt(t,e,r){return t instanceof A?[t.x||0,t.y||0,t.z||0]:t instanceof Array?[t[0]||0,t[1]||0,t[2]||0]:[t||0,e||0,r||0]}Mt(t,e,r){t=this.dt(t,e,r);return t.every(t=>Number.isFinite(t))&&t.every(t=>"number"==typeof t),t}add(t,e,r){var i=this.vt();return t instanceof A?(i.x+=t.x||0,i.y+=t.y||0,i.z+=t.z||0):t instanceof Array?(i.x+=t[0]||0,i.y+=t[1]||0,i.z+=t[2]||0):(i.x+=t||0,i.y+=e||0,i.z+=r||0),i}sub(t,e,r){var i=this.vt();return t instanceof A?(i.x-=t.x||0,i.y-=t.y||0,i.z-=t.z||0):t instanceof Array?(i.x-=t[0]||0,i.y-=t[1]||0,i.z-=t[2]||0):(i.x-=t||0,i.y-=e||0,i.z-=r||0),i}gt(t,e,r){var i,s=this.vt();return t instanceof A?Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z&&(s.x*=t.x,s.y*=t.y,s.z*=t.z):t instanceof Array?t.every(t=>Number.isFinite(t))&&t.every(t=>"number"==typeof t)&&(1===t.length?(s.x*=t[0],s.y*=t[0],s.z*=t[0]):2===t.length?(s.x*=t[0],s.y*=t[1]):3===t.length&&(s.x*=t[0],s.y*=t[1],s.z*=t[2])):(i=[...arguments]).every(t=>Number.isFinite(t))&&i.every(t=>"number"==typeof t)&&(1===arguments.length&&(s.x*=t,s.y*=t,s.z*=t),2===arguments.length&&(s.x*=t,s.y*=e),3===arguments.length)&&(s.x*=t,s.y*=e,s.z*=r),s}div(t,e,r){var i=this.vt();if(t instanceof A){if(Number.isFinite(t.x)&&Number.isFinite(t.y)&&Number.isFinite(t.z)&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z){if(0===t.x||0===t.y||0===t.z)return i;i.x/=t.x,i.y/=t.y,i.z/=t.z}}else if(t instanceof Array){if(t.every(t=>Number.isFinite(t))&&t.every(t=>"number"==typeof t)){if(t.some(t=>0===t))return i;1===t.length?(i.x/=t[0],i.y/=t[0],i.z/=t[0]):2===t.length?(i.x/=t[0],i.y/=t[1]):3===t.length&&(i.x/=t[0],i.y/=t[1],i.z/=t[2])}}else{var s=[...arguments];if(s.every(t=>Number.isFinite(t))&&s.every(t=>"number"==typeof t)){if(s.some(t=>0===t))return i;1===arguments.length&&(i.x/=t,i.y/=t,i.z/=t),2===arguments.length&&(i.x/=t,i.y/=e),3===arguments.length&&(i.x/=t,i.y/=e,i.z/=r)}}return i}wt(t){return null!=t?this.vt().normalize().gt(t):Math.sqrt(this.bt())}bt(){var t=this.x,e=this.y,r=this.z;return t*t+e*e+r*r}yt(t,e,r){return t instanceof A?this.yt(t.x,t.y,t.z):this.x*(t||0)+this.y*(e||0)+this.z*(r||0)}Nt(t){var e=this.y*t.z-this.z*t.y,r=this.z*t.x-this.x*t.z,t=this.x*t.y-this.y*t.x;return new A(e,r,t)}_t(t,e=null){return t.vt(e).sub(this.vt(e)).wt()}normalize(){var t=this.wt();let e=this.vt();return e=0!==t?e.gt(1/t):e}St(){return this.normalize()}xt(t){var e=this.vt(),r=e.bt();return t*t<r&&e.div(Math.sqrt(r)).gt(t),e}heading(t){var e,r;return t?(r=(e=this.vt()).wt(),e.x=r*Math.cos(t),e.y=r*Math.sin(t),e):Math.atan2(this.y,this.x)}rotate(t){var e=this.vt(),t=e.heading()+t,r=e.wt();return e.x=Math.cos(t)*r,e.y=Math.sin(t)*r,e}At(t){var e=this.yt(t)/(this.wt()*t.wt()),e=Math.acos(Math.min(1,Math.max(-1,e)));return e*=Math.sign(this.Nt(t).z||1)}Pt(t){return this.wt()>Number.EPSILON&&t.wt()>Number.EPSILON?this.At(t):0}Wt(t,e,r,i){var s;return t instanceof A?this.Wt(t.x,t.y,t.z,e):((s=this.vt()).x+=(t-s.x)*i||0,s.y+=(e-s.y)*i||0,s.z+=(r-s.z)*i||0,s)}Et(){return[this.x||0,this.y||0,this.z||0]}equals(t,e,r){let i,s,n;return n=t instanceof A?(i=t.x||0,s=t.y||0,t.z||0):t instanceof Array?(i=t[0]||0,s=t[1]||0,t[2]||0):(i=t||0,s=e||0,r||0),this.x===i&&this.y===s&&this.z===n}Ct(t){var e=this.vt();return t.normalize(),e.sub(t.gt(2*e.yt(t)))}It(t,e){var r=this.vt(),e=e/2,i=Math.sin(e),s=t.x*i,n=t.y*i,t=t.z*i,i=Math.cos(e),e=r.x,h=r.y,a=r.z,u=i*e+n*a-t*h,o=i*h+t*e-s*a,l=i*a+s*h-n*e,e=-s*e-n*h-t*a;return r.x=u*i+e*-s+o*-t-l*-n,r.y=o*i+e*-n+l*-s-u*-t,r.z=l*i+e*-t+u*-n-o*-s,r}kt(t,e=0){var r=this.vt(),t=t.St().wt(t.St().yt(r));return r.set(e?r.sub(t):t)}Ft(t=2){return 1==t?Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z):this.wt()}Lt(t=1){var e=this.normalize(),r=e.Et();return(SW=(t,e,r)=>[t[e],t[r]]=[t[r],t[e]])(r,1,t),r=[Math.atan2(r[2],Math.sqrt(r[0]**2+r[1]**2)),0,-Math.atan2(r[0],r[1])],SW(r,1,t),e.set(r),e}Tt(t=null){var e=this.vt(),r=(-e.x-e.y)/e.z;return t=t&&t.wt()>Number.EPSILON&&1-Math.abs(e.St().yt(t.St()))>Number.EPSILON?t:new A(1,1,isFinite(r)?r:1),e.Nt(t).St()}Ht(t,e){var r=this.vt(),[r,t,e]=r.wt()<=Number.EPSILON?[t,r,1-e]:[r,t,e];return r.It(r.St().Tt(t),Math.abs(t.St().Pt(r.St()))*e).wt(e*(t.wt()-r.wt())+r.wt())}Rt(){return Math.abs(this.x)<=Math.EPSILON&&Math.abs(this.y)<=Math.EPSILON&&Math.abs(this.z)<=Math.EPSILON}toString(t=","){return this.Et().join(t)}hash(t=6){return(this.x||0).toFixed(t)+","+(this.y||0).toFixed(t)+","+(this.z||0).toFixed(t)}Dt(t,e){return void 0===e&&(e=1),new A(e*Math.cos(t),e*Math.sin(t),0)}}class l{constructor(t,e){this.Vt=0,this.min=new A,this.max=new A,t&&this.add(e?[t.sub(e,e,e),t.add(e,e,e)]:t)}add(i){i=[i].flat();let s=this;return[["min",Math.min],["max",Math.max]].map(([r,t])=>s[r].set(["x","y","z"].map(e=>t(...i.map(t=>(i[0]instanceof l?t[r]:t)[e]).concat(s.Vt?[s[r][e]]:[]))))),s.Vt=1,s}translate(t,e=0){t=e?t.gt(-1):t;e=this;return e.min=e.min.add(t),e.max=e.max.add(t),e}scale(t,e=0){var r=this;return r.min=r.min.gt(t=e?1/t:t),r.max=r.max.gt(t),r}clear(){this.Vt=0}zt(){return this.min.add(this.max).div(2)}Bt(){return this.max.sub(this.min)}jt(t=3){return Math.max(...this.Bt().Et().splice(0,t))}Ot(t=3){return Math.max(...this.Bt().Et().splice(0,t))}qt(t=0){let r=this,e=r.Bt().div(2).Et(),i=e._()/3,s=r.zt();return t?[r.qt().map(t=>t.wt(i)),S(3,2).map(([r,i])=>s.add(new A(...e.map((t,e)=>r==e?t*(2*i-1):0))))].flat():S(2,2,2).map(t=>new A(...t.map((t,e)=>(0<t?r.max:r.min).Et()[e])))}}function it(t,e){var t=t instanceof A?t.Et():t,r=e.map(t=>t instanceof A?t.Et():t),i=t[0],s=t[1];let n=!1;for(let t=0,e=r.length-1;t<r.length;e=t++){var h=r[t][0],a=r[t][1],u=r[e][0],o=r[e][1];s<a!=s<o&&i<(u-h)*(s-a)/(o-a)+h&&(n=!n)}return n}const P=(t,e=null)=>{var r=t.map(t=>t instanceof p?t.Gt(e):t instanceof A?t:void 0).flat(2);let i=r.splice(0,1);for(;1<r.length;){let e=(new A).Dt(j(r.map(t=>t.sub(i.at(-1)).heading()),2*Math.PI));var s=r.map(t=>{t=t.sub(i.at(-1));return{angle:e.Pt(t.St()),_t:t.wt()}}).L((t,e)=>Math.abs(e.angle-t.angle)>Number.EPSILON?e.angle-t.angle:e._t-t._t);i.push(r[s]),r.splice(0,s+1)}return 0<r.length&&i.push(r.shift()),r.length,i},st=(t,e,r)=>t.sub(e).yt(r)>=-Number.EPSILON&&t.sub(e.add(r)).yt(r.gt(-1))>=-Number.EPSILON?t.sub(e).kt(r,!0).wt():null,nt=(e,t,r)=>{var i={};return e.sub(t).yt(r)>=-Number.EPSILON&&e.sub(t.add(r)).yt(r.gt(-1))>=-Number.EPSILON?(i.Zt=e.sub(t).kt(r,!1).add(t),i.Jt=e._t(i.Zt)):[i.Zt,i.Jt]=[t.vt(),t.add(r)].map(t=>[t,e._t(t)]).sort((t,e)=>t[1]-e[1]).at(0),i},ht=(t,e,r)=>nt(t,e,r.sub(e)),W=(t,e=!1)=>{var r=[];let i=-1;for(;i++<t.length-1;)(0==r.length||t[i]._t(r.at(-1))>Number.EPSILON)&&r.push(t[i]);return e&&2<=r.length&&r.at(0)._t(r.at(-1))<=Number.EPSILON&&r.pop(),r},at=(i,s=!1)=>{let n=[];return i.forEach((t,e)=>{var r;(!(s||0!=e&&e!=i.length-1)||(r=t.sub(i.at(e-1)).St(),e=i.at(e+1).sub(t).St(),Math.abs(r.yt(e)-1)>Number.EPSILON))&&n.push(t.vt())}),n},ut=(r,t=!1,e=!1,i=null)=>{var t=(t?r:[...r].splice(0,r.length-1)).map((t,e)=>t._t(r.at(e+1),i)),s=t._();return e?[s,t]:s},ot=(e,r)=>{var t=S(r).map(t=>{t/=r-(e.closed?0:1);return e.Yt(t*e.length)});return e instanceof E?e.Xt=t:(e.removeSegments(0,e.segments.length),e.addSegments(t)),e},lt=(h,r,t,a=null)=>{let u=h instanceof E,o=[[0],S(r).map(t=>[-(t+1),t+1])].flat(2),l=o.map(t=>m(1-Math.abs(t/(r+1))));return S(t).forEach(()=>{var t=S((u?h.Xt:h.segments).length).map(n=>{var[t,e]=S(1+2*r).reduce(([t,e],r)=>{var i=u?h.Xt.at(n+o[r]):h.segments.at(n+o[r]).Zt,s=null==a?1:a.at(n+o[r]),r=l[r]*s;return t.x+=i.x*r,t.y+=i.y*r,u&&(t.z+=i.z*r),[t,e+=r]},[new(u?A:Point),0]);return t.x=M(t.x,e),t.y=M(t.y,e),u&&(t.z=M(t.z,e)),t});h instanceof E?h.Xt=t:(h.removeSegments(0,h.segments.length),h.addSegments(t))}),h},ct=(t,e,r)=>{let i=Math.max(e.Bt().x,e.Bt().y),s=(e.min.x+e.max.x)/2,n=(e.min.y+e.max.y)/2,h=Math.min(r.Bt().x,r.Bt().y),a=(r.min.x+r.max.x)/2,u=(r.min.y+r.max.y)/2;if(t instanceof E)t.Xt=t.Xt.map(t=>t.add(-s,-n).gt(1/i).gt(h).add(a,u));else{let e=(new Matrix).translate(a,u).scale(h).scale(1/i).translate(-s,-n);t.segments.forEach(t=>{t.transform(e)})}return t},ft=(t,e)=>{let s=new E(e);return t.map(t=>{var e=s.Kt(t),r=e.offset,i=s.Qt(r),i=new A(i.x,i.y).gt(-1),e=t.sub(e.Zt);return[t,r,e.Pt(i)]}).sort((t,e)=>{var r=t[1]-e[1];return Math.abs(r)<Number.EPSILON?t[2]-e[2]:r}).map(([t])=>t)},vt=(t,e,n,h,a,r,i)=>{let u=W([...t]);if(u.length<=1)return u.map(()=>new A);let o=u.map((r,i)=>{let t=[];if(i<u.length-1&&null!=a){var s=r._t(u.at(i+1));let e=Math.ceil(s/a);t=S(e-1).map(t=>{t=(t+1)/e;return r.Wt(u.at(i+1),t)})}return[r].concat(t)}).flat(),l=new E(o),c=e.St(),s=o.map((t,e)=>{var r=0<e?o.at(e-1):null,i=e<o.length-1?o.at(e+1):null,r=r?t.sub(r).St().rotate(Math.PI/2):null,i=i?i.sub(t).St().rotate(Math.PI/2):null;let s=(r=r||i).Ht(i||r,.5).Ht(c,n);return null!=h&&(t=v(l.Ut.at(e),0,l.length),i=x(t,0,Math.min(h,l.length/2),0,1,!0),s=s.gt(i)),s});t=r=>o.map((t,e)=>t.add(s[e].gt(r)));let f=o;return null!=r?f=t(r):null!=i&&(f=i<=l.length?u:t(i**2/ut(t(1))**2)),P(f)},dt=(t,e)=>new E(e).$t(t),g=(t,e,r)=>e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y),w=(t,e,r)=>{t=(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y);return 0==t?0:0<t?1:2},Mt=(t,e,r,i)=>{var s=w(t,e,r),n=w(t,e,i),h=w(r,i,t),a=w(r,i,e);return s!=n&&h!=a?1:0==s&&g(t,r,e)||0==n&&g(t,i,e)||0==h&&g(r,t,i)||0==a&&g(r,e,i)?0:-1},mt=(t,e,r,i)=>{var s;return t.x===e.x&&t.y===e.y||r.x===i.x&&r.y===i.y||0==(s=(i.y-r.y)*(e.x-t.x)-(i.x-r.x)*(e.y-t.y))||(i=((i.x-r.x)*(t.y-r.y)-(i.y-r.y)*(t.x-r.x))/s,r=((e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x))/s,i<0)||1<i||r<0||1<r?null:(s=t.x+i*(e.x-t.x),r=t.y+i*(e.y-t.y),new A(s,r))},gt=t=>{let n=0;return t.forEach(e=>{let s=e.te;s.forEach((r,i)=>{s.forEach((t,e)=>{1<v(i,e,s.length)&&0<=Mt(...r,...t)&&n++})}),t.filter(t=>t!=e).forEach(t=>{let r=t.te;s.forEach(e=>{r.forEach(t=>{0<=Mt(...e,...t)&&n++})})})}),n/2},wt=t=>{let u={},a=(t,e,r,i,s,n)=>{var h,a=mt(...t,...e);null==a||(h=a.hash())in u||(r={Zt:a.vt(),ee:h,path:r,offset:r.Ut[s]+a._t(t[0])},s={Zt:a.vt(),ee:h,path:i,offset:i.Ut[n]+a._t(e[0])},(r.re=s).re=r,u[h]=[r,s])};return t.forEach(n=>{let h=n.te;h.forEach((r,i)=>{h.forEach((t,e)=>{1<v(i,e,h.length)&&a(r,t,n,n,i,e)})}),t.filter(t=>t!=n).forEach(s=>{let t=s.te;h.forEach((r,i)=>{t.forEach((t,e)=>{a(r,t,n,s,i,e)})})})}),Object.values(u)};class E{constructor(t=[]){this.Xt=t,this.ie=!1,this.se=!1,this.ne=null,this.he=null,this.ae=null,this.ue=null}set closed(t){this.ie=t,this.oe()}get closed(){return this.ie}set le(t){this.se=t,this.ce()}get le(){return this.se}set fe(t){this.ne=t,this.oe()}get fe(){return this.ne}get Xt(){return this.ve(),this.de}get Me(){return this.Ut.map(t=>this.me(t))}get ge(){return this.Ut.map(t=>this.Qt(t))}ce(){this.we=!0,this.oe()}ve(){this.we&&(this.we=!1,this.de=this.pe.map(t=>this.le?t.vt():t.vt().vt("xy")))}set Xt(t){this.pe=t.map(t=>t instanceof A?t.vt():new A(...t)),this.ce()}get length(){return this.be(),this.he}get ye(){return this.Xt.length-(this.closed?0:1)}get Ut(){return this.be(),[0].concat([...this.ue]).splice(0,this.Xt.length)}get Ne(){return this.Ut.map(t=>t/this.length)}get te(){return S(this.ye).map(t=>[this.Xt.at(t),this.Xt.at(t+1)])}oe(){this._e=!0}be(){this._e&&(this._e=!1,[this.he,this.ae]=ut(this.Xt,this.closed,!0,this.fe),this.ue=this.ae.P())}Kt(...r){r=r.at(0)instanceof A?r.at(0):new A(...r.flat());var t=S(this.ye).map(t=>{var e=ht(r,this.Xt.at(t),this.Xt.at(t+1));return e.index=t,e}).sort((t,e)=>t.Jt==e.Jt?t.index-e.index:t.Jt-e.Jt).at(0);return null==t?null:(this.be(),t.offset=_([0].concat(this.ue).at(t.index)+t.Zt._t(this.Xt[t.index]),0,this.length),t)}Se(t){this.be(),t=_(t,0,this.length);let e=_([0].concat(this.ue).W(t),0,this.ye);return this.closed&&(e%=this.ye),e}Yt(t){var t=this.Se(t),e=Math.floor(t),r=Math.ceil(t),t=t-e;return this.Xt.at(e).Wt(this.Xt.at(r),t)}me(t,e=!0,r=!1){let i=this.Se(t),s=(Math.abs(i-Math.round(i))<Number.EPSILON&&(i=Math.round(i)),this.Yt(t));var n,t=(t,e)=>{let r=t;for(let t=0;t<this.ye+1;t++){var i=Math.round(r)==r?r+e:0<=e?Math.ceil(r):Math.floor(r);if((i=this.closed?i%this.Xt.length:_(i,0,this.Xt.length-1))==r)return null;if(this.Xt.at(i).hash()!=s.hash())return this.Xt.at(i);r=i}return null},h=t(i,-1),t=t(i,1);return null==h&&null==t?new A:(n=h?(e?s.vt("xy").sub(h.vt("xy")):s.sub(h)).St():null,e=t?(e?t.vt("xy").sub(s.vt("xy")):t.sub(s)).St():null,h=(h?t?n.Ht(e,.5):n:e).St(),r?[h,n.Tt(e)]:h)}Qt(t,e=!0){var r;return this.le?e?this.me(t).vt("xy").St().Nt(new A(0,0,1)):([e,r]=this.me(t,!1,!0),e.Tt(r)):this.me(t).rotate(-Math.PI/2)}$t(t){return(t=[t].flat()).map(t=>[t,this.Kt(t)]).map(([t,e])=>{var r=this.Qt(e.offset),t=t.sub(e.Zt).St().yt(r);return e.Jt*(0<=t?1:-1)})}xe(){this.Xt=W(this.Xt,this.closed)}Ae(){this.Xt=at(this.Xt,this.closed)}reduce(){return this.xe(),this.Ae(),this}Pe(){this.Xt=[]}remove(){}}class p{constructor(t,e=""){var r=this;r.We=t,r.Ee=S(t).map(t=>null),r.Ce=S(t).map(t=>!1),r.Ie=!1,r.ke=[],r.Fe=[],r.Le=-1,r.Te=p.He++,r.name=e,r.position=null}id(){return this.Te.toString()}clear(){this.Re(),this.Ie=!1,this.De(),this.Ve(),this.ze(),this.Be(),this.Be()}Re(){this.Ce=S(this.We).map(t=>!1)}De(){this.ke=[]}Ve(){this.Fe=[]}ze(){this.Le=-1}Be(){this.position=null}setPosition(t){this.position=t}Gt(){return this.position}je(){return null!=this.position}Oe(){return this.ke.map(t=>t.Le).k().at(0)}qe(){return this.ke.map(t=>t.Le).k().at(-1)}Ge(t,e,r=null){return!(t<0||t>=this.We)&&(this.Ee[t]=e,null==r||e.Ge(r,this))}Ze(e){var t=this.Ee.map((t,e)=>[t,e]).filter(([t])=>t==e);return 1==t.length?t[0][1]:(t.length,-1)}valid(){let e=this;return e.Ee.length==e.We&&e.Ee.every(t=>null!=t&&t instanceof p&&t!=e)&&new Set(e.Ee).size==e.We&&e.Ee.every(t=>0<=t.Ze(e))&&e.Ce.length==e.We}Je(t=0){let r=this;r.Ee.forEach((t,e)=>{0==e&&r.id(),t.id()})}Ye(t=""){var e=this,r=new e.constructor(t);return r.Ee=e.Ee.map(t=>t),r.Ce=e.Ce.map(t=>t),r.Ie=e.Ie,r.ke=e.ke.map(t=>t),null!=e.position&&(r.position=e.position.vt()),r.name=t,r}Xe(t,e=2){if(Number.isInteger(t))t=this.Ee[t];else if(!(t instanceof p))return[null,null];let r=this,i=t;S(e-1).forEach(t=>{var e=(i.Ze(r)+i.We/2)%i.We;i=(r=i).Ee[e]});t=i.Ze(r);return[i,t]}}p.He=0;class C extends p{constructor(t=""){super(4,t),this.Ke()}je(){return super.je()&&this.position instanceof A}Y(){return this.We/2}Ke(){this.Qe=S(this.Y()).map(t=>-1)}Ue(t){return this.Qe[t%this.Y()]}$e(t,e){this.Qe[t%this.Y()]=e}tr(t){t=this.Ze(t);return this.Ue(t)}er(t,e){t=this.Ze(t);return this.$e(t,e)}rr(){let s=this;if(s.Qe.length!=s.Y())return!1;if(!S(s.Y()).every(t=>s.Qe.includes(t)))return!1;return s.Qe.every((r,i)=>s.Ee.filter((t,e)=>e%s.Y()==i).map(t=>[t,t.Ee[(t.Ze(s)+1)%2]]).every(([t,e])=>{var t=e.Ze(t);return!(t<0)&&(t=t%e.Y(),e=e.Qe[t],(t=r)*(e=e)==0)&&t+e==1}))}valid(){return super.valid()&&this.Ee.every(t=>t instanceof I)&&this.rr()}}class I extends p{constructor(t=""){super(2,t),this.ir=null}valid(){return super.valid()&&this.Ee.every(t=>t instanceof C)}je(){return super.je()&&Array.isArray(this.position)&&this.position.every(t=>t instanceof A)&&null!=this.ir&&this.ir instanceof b}Be(){super.Be(),this.ir=null}setPosition(t,e){super.setPosition([t].flat()),this.ir=e}Gt(i){if(i instanceof b)return i==this.ir?[...this.position]:[...this.position].reverse();if(i instanceof C){var t=this.ke.filter(t=>{var e=t.sr.indexOf(this),r=t.sr.indexOf(i);return 1==B(e,r,t.sr.length)}).at(0);if(null!=t)return this.Gt(t)}return super.Gt()}}class b{constructor(t){var e=t.map((t,e)=>[t,e]).filter(([t])=>t instanceof C)[0][1];this.sr=t.F(e),t.forEach(t=>t.ke.push(this)),this.Ie=!1,this.Te=b.He++,this.Le=-1,this.Ee=[],this.weight=null,this.nr=null}get inner(){return!this.Ie}clear(){this.ze(),this.hr(),this.sr=[],this.Ie=!1,this.Ee=[],this.nr&&this.nr.remove(),this.nr=null}get ar(){return this.sr.length/2}get ur(){return this.sr.filter(t=>t instanceof C)}get lr(){return this.ar}get cr(){return this.sr.filter(t=>t instanceof I)}get vr(){return this.ar}ze(){this.Le=-1}hr(){this.weight=null}Je(){this.Ie}valid(){let i=this;return 4<=i.sr.length&&i.sr.length%2==0&&i.sr.at(0)instanceof C&&S(i.sr.length).every(t=>{var e=i.sr.at(t-1)instanceof C?1:0,t=i.sr.at(t)instanceof C?1:0;return e*t==0&&e+t==1})&&S(i.sr.length).every(t=>{var e=i.sr.at(t).Ze(i.sr.at(t-1)),r=i.sr.at(t).Ze(i.sr.at(t+1)),e=o(e,r,i.sr.at(t).We);return i.sr.at(t)instanceof C?-1==e:1==Math.abs(e)})}size(){return this.sr.length}dr(){this.Ee=[...new Set(this.sr.filter(t=>t instanceof I).map(t=>t.ke).flat().filter(t=>t!=this))]}Mr(n,u=.8,o=12,l=.8,c=Math.PI/4,f=.5,v=.1,d=1){let e=new Set(n.map(t=>t.sr).flat()),r=new Set(n.map(t=>t.sr).flat().filter(t=>t instanceof C));var M=new Set(this.sr.filter(t=>e.has(t))),m=new Set(this.sr.filter(t=>t instanceof C).filter(t=>r.has(t))),g=new Set(this.sr.filter(t=>!e.has(t)));let w=new Set(this.sr.filter(t=>t instanceof C).filter(t=>!r.has(t)));if(0==n.length){let i=this.vr,s=.5/Math.sin(Math.PI/i),n=2==i?s/2:.5/Math.tan(Math.PI/i),h=N.n(0,2*Math.PI);this.sr.forEach((t,e)=>{var r=t instanceof C?s:n;t.setPosition(new A(r,0).rotate(h+2*Math.PI/i*e/2),this)})}else{if(0==m.size)return!1;if(1==m.size){var m=[...m][0],p=m.ke.filter(t=>n.includes(t)).at(0);if(null==p)return!1;let r=p.mr(m),i=m.Gt(this),s=(i.wt()<Number.EPSILON||(p=i.St(),r=r.Ht(p,.5)),this.sr.indexOf(m));if(s<0)return!1;if(2==this.ar){p=Math.atan(.5),m=.5/Math.cos(p);this.sr.at(s+1).setPosition(r.rotate(-p).wt(m).add(i),this),this.sr.at(s+2).setPosition(r.wt(1).add(i),this),this.sr.at(s+3).setPosition(r.rotate(p).wt(m).add(i),this)}else{this.vr,this.sr.at(s+2).setPosition(r.rotate(-30/180*Math.PI).wt(1).add(i),this),this.sr.at(s-2).setPosition(r.rotate(30/180*Math.PI).wt(1).add(i),this);let e=this.vr-1;3<=e&&S(e-2).forEach(t=>{this.sr.at(s+2*(2+t)).setPosition(r.rotate(Math.PI).rotate(3*Math.PI/e).rotate(2*t*Math.PI/e).wt(.5/Math.sin(Math.PI/e)).add(r.wt(.5/Math.tan(Math.PI/e))).add(r.wt(.5*Math.sqrt(3))).add(i),this)}),this.sr.filter(t=>t instanceof I).forEach(t=>{t.setPosition(t.Ee.reduce((t,e)=>t.add(e.Gt(this)),new A).div(t.Ee.length),this)})}}else{var b=[...this.sr];let t=b.length;for(;M.has(b[0])&&0<=t--;)b.F(1);if(t<0)return!1;for(;g.has(b.at(0));)b.shift();for(;g.has(b.at(-1));)b.pop();if(0==b.length)return!1;if(M.size!=b.length)return!1;let r=P(b,this),e=(r.length,[...r].splice(1).map((t,e)=>[r.at(e),t.sub(r.at(e))]));var p=b.map(t=>t.Gt(this)).flat(2).filter(r=>e.map(([t,e])=>st(r,t,e)).filter(t=>null!=t).min()<1).map(e=>{var t=Math.min(r.R(0,-1).map(t=>e._t(t)*u).min(),1);return[e,t]}).filter(([,t])=>t>Number.EPSILON).map(([e,r])=>S(o).map(t=>{t=2*Math.PI*t/o;return(new A).Dt(t,r).add(e)})).flat(2),m=[],y=b.map(t=>t.Gt(this)).flat(2);m.push(y.at(1).sub(r.at(0)).wt(Math.min(f,l*r.at(0)._t(r.at(-1)))).rotate(c).add(r.at(0))),m.push(y.at(-2).sub(r.at(-1)).wt(Math.min(f,l*r.at(0)._t(r.at(-1)))).rotate(-c).add(r.at(-1)));let i=[r,p,m].flat();y=dt(i,r).map((t,e)=>[t,i[e]]).filter(([t])=>t<=Number.EPSILON).map(([,t])=>t),f=ft(y,r);let s=P(f);if((s=W(s)).length<=1)return!1;S(2).map(t=>{s=vt(s,s.at(-1).sub(s.at(0)).St().rotate(Math.PI/2),.5,1,.5,null,(w.size+1)*x(t,-1,1,0,1,!0)*_(s.at(-1)._t(s.at(0))/(w.size+1),d,1))}),s.reverse();let n=new E(s),h=this.sr.indexOf(b.at(-1))+2,a=(S(w.size).forEach(t=>{var e=this.sr.at(h+2*t),t=(t+1)*n.length/(w.size+1),t=n.Yt(t);e.setPosition(new A(t.x,t.y),this)}),this.sr.indexOf(b.at(-1))+1);S(w.size+1).forEach(t=>{var e=this.sr.at(a+2*t);let r=t/(w.size+1)*n.length,i=(t+1)/(w.size+1)*n.length;var s,t=n.Ut.map((t,e)=>[t,e]).filter(([t])=>t-r>Math.max(Number.EPSILON,v)&&i-t>Math.max(Number.EPSILON,v)).map(([,t])=>n.Xt.at(t).vt());0==t.length&&(s=(r+i)/2,s=n.Yt(s),t.push(new A(s.x,s.y))),e.setPosition(t,this)}),n.remove()}}l=new Set(this.sr.filter(t=>t instanceof C).map(t=>t.Gt(this)).flat(2).map(t=>t.hash()));if(this.ar!=l.size)return!1;if(![...g].map(t=>t.Gt(this)).flat().every(e=>n.every(t=>!it(e,t.nr.Xt))))return!1;this.nr=new E(this.sr.map(t=>t.Gt(this)).flat()),this.nr.closed=!0;let i=this.nr.Xt.map(t=>t.hash());return!!n.map(t=>t.sr.map(t=>t.Gt(this))).flat(2).map(t=>[t.hash(),t]).every(([e,t])=>!it(t,this.nr.Xt)||!i.every(t=>t!=e))||(this.nr.remove(),this.nr=null,!1)}mr(t){t=this.sr.indexOf(t);if(t<0)return null;let e=null,r=this.sr.at(t).Gt(this),i=null;Array.isArray(r)&&(r=1==r.length?r[0]:(e=r.at(Math.floor((r.length-1)/2-.5)),i=r.at(Math.ceil((r.length-1)/2+.5)),r.at(Math.floor((r.length-1)/2)).add(r.at(Math.ceil((r.length-1)/2))).div(2))),e||(e=this.sr.at(t-1).Gt(this),Array.isArray(e)&&(e=e.at(-1))),i||(i=this.sr.at(t+1).Gt(this),Array.isArray(i)&&(i=i.at(0)));var t=e.sub(r).normalize(),s=i.sub(r).St(),s=u(t.Pt(s),2*Math.PI);return t.rotate(s/2)}}b.He=0;class y{constructor(t){this.sr=t,[...new Set(t)].forEach(t=>t.Fe.push(this)),this.Te=y.He++,this.Ee=[]}clear(){this.Ee=[]}Je(){let s=this;S(s.sr.length).map(t=>{var e=s.sr.at(t),r=e.id();let i="-";return e instanceof C&&(e=e.tr(s.sr.at(t+1)),i=0==e?"_":"Â¯"),i+" "+r+" "+i})}valid(){let s=this;return 4<=s.sr.length&&s.sr.length%2==0&&S(s.sr.length).every(t=>{var e=s.sr.at(t-1)instanceof C?1:0,t=s.sr.at(t)instanceof C?1:0;return e*t==0&&e+t==1})&&S(s.sr.length).every(t=>{var e=s.sr.at(t+0),r=s.sr.at(t+1),t=s.sr.at(t+2);return e.Xe(r)[0]==t&&t.Xe(r)[0]==e})&&(()=>{let i=s.sr[0]instanceof C?0:1;return S(s.sr.length/2).every(t=>{var e=s.sr.at(i+2*t),r=s.sr.at(i+2*t+1),t=s.sr.at(i+2*t+2),e=e.tr(r),t=t.tr(r);return 0<=e&&0<=t&&e!=t})})()&&s.Ee.every(t=>t.Ee.includes(s))}gr(i=.5,a=1){if(!this.sr.every(t=>t.je()))return null;return this.sr.map((t,e)=>{var r;return t instanceof I?t.Gt(this.sr.at(e-1)).map(t=>t.vt()):(r=t.Gt().vt(),t=t.tr(this.sr.at(e+1)),r.z=x(t,0,1,-i,i,!0),r)}).map((r,t,e)=>{if(Array.isArray(r)){let n=e.at(t-1),h=e.at(t+1);[n,r,h].flat().map((t,e,r)=>{return 0==e?0:(t=t,r=r.at(e-1),Math.sqrt((t.x-r.x)**2+(t.y-r.y)**2))}).splice(1).P().map((t,e,r)=>{var i,t=m((t=t,r=r.at(-1),i=a,Math.sign(o(t,0,r))*x(Math.abs(t-r/2),Math.max(r/2-i,0),r/2,0,-.5,!0)+.5));let s=x(t,0,1,n.z,h.z,!0);return s=Math.abs(s)<=Number.EPSILON?0:s}).splice(0,r.length).forEach((t,e)=>r[e].z=t)}return r}).flat()}}y.He=0;const pt=t=>{let e={};return t.forEach(t=>{t in e||(e[t]=0),e[t]++}),e},k=t=>{t=pt(t);return Object.entries(t).map(t=>(t[0]=parseInt(t[0]),t)).sort((t,e)=>t[0]==e[0]?t[1]-e[1]:t[0]-e[0]).map((t,e)=>(t[0]+1)*(t[1]+1)*31**e)._()},bt=(t,e=!1,r=32,i=!1)=>{const s=2**r-1;t.forEach(t=>t.wr=1+(i?t.Le:0));let n=t.length;for(;0<=--n;)t.forEach(t=>{t.pr=t.wr,t.br=t.Ee.map(t=>t.wr)}),t.forEach(t=>{t.wr=(t.pr+1)*(k(t.br)+1)%s});let h=k(t.map(t=>t.wr))%s;return e&&(h="0x"+h.toString(16).padStart(r/4,"0")),t.forEach(t=>{delete t.pr,delete t.br}),h},yt=e=>S(e).map(t=>t+1).filter(t=>{t=e/t;return Math.abs(Math.round(t)-t)<=Number.EPSILON}),Nt=t=>k([...t].map(t=>t.wr))%(2**32-1),_t=(network,e,t,r,i=100)=>{if(!r.map(t=>Nt(t)).every((t,e,r)=>t==r[0]))return!1;let s=new Set([e]),n=new Set(network.ke.filter(t=>t.inner&&t!=e)),h=r.map(r=>new Set(r.filter((t,e)=>t instanceof I||0<e&&e<r.length-1).map(t=>t.ke.filter(t=>n.has(t))).flat())),a=0;for(;a++<i&&0<n.size;){if(!h.map(t=>Nt(t)).every((t,e,r)=>t==r[0]))return!1;[...new Set(h.map(t=>[...t]).flat())].forEach(t=>{n.delete(t),s.add(t)}),h=h.map(t=>new Set([...t].map(t=>t.Ee).flat().filter(t=>n.has(t))))}return!(a>=i)},St=network=>{network.yr(32,!0),network.Nr(32,!0),S(network.sr.length).forEach(()=>{let r=network.ke.map(t=>k(t.sr.map(t=>t.wr).concat(t.wr))%(2**32-1)),i=network.sr.map(t=>k(t.ke.map(t=>t.wr).concat(t.wr))%(2**32-1));network.ke.forEach((t,e)=>t.wr=r[e]),network.sr.forEach((t,e)=>t.wr=i[e])});let e=1;var r=network.ke.filter(t=>t.inner).sort((t,e)=>e.Le-t.Le).map(e=>yt(e.vr).concat(e.vr%2==0?[]:[2]).k().reverse().filter(t=>1<t).map(t=>[e,t])).flat().sort((t,e)=>e[1]-t[1]).map(([r,i])=>{let s=r.vr/i;return S(2*s).map(t=>{let e=[...r.sr].F(t);t=S(i).map(t=>[...e].F(t*s*2).splice(0,2*s+1));return 2==i?[[r,i,t],[r,i,t.map((t,e)=>e%2==1?[...t].reverse():[...t])]]:[[r,i,t]]}).flat()}).flat();for(let t=0;t<r.length;t++)if(_t(network,...r[t])){e=r[t][1];break}return e},xt=(network,t=32)=>{const e=2**t-1;return network.yr(t,!0),network.Nr(t,!0),S(network.sr.length).forEach(()=>{let r=network.ke.map(t=>k(t.sr.map(t=>t.wr).concat(t.wr))%e),i=network.sr.map(t=>k(t.ke.map(t=>t.wr).concat(t.wr))%e);network.ke.forEach((t,e)=>t.wr=r[e]),network.sr.forEach((t,e)=>t.wr=i[e])}),Object.values(pt(network.ke.map(t=>t.wr))).max()},At=network=>xt(network);class Pt{constructor(){var t=this;t.sr=[],t.ke=[],t._r=!1,t.Fe=[],t.Sr=!1,t.Ar=-1,t.Pr=!1,t.initialize(),t.update()}clear(){this.sr.forEach(t=>t.clear()),this.sr=[],this.Fe.forEach(t=>t.clear()),this.Fe=[],this.Sr=!1,this.ke.forEach(t=>t.clear()),this.ke=[],this._r=!1,this.Ar=-1,this.Pr=!1}Je(){let e=this.sr.reduce((t,e)=>Math.max(t,e.id().length+1),0);this.sr.forEach(t=>t.Je(e)),this.ke.forEach(t=>t.Je()),this.Fe.forEach(t=>t.Je())}initialize(){var t=new C("i0"),e=new C("i1"),r=new I("e0"),i=new I("e1"),s=new I("e2"),n=new I("e3");t.Ge(0,r,0),t.Ge(1,i,0),t.Ge(2,s,0),t.Ge(3,n,0),t.Ie=!0,e.Ge(0,n,1),e.Ge(1,s,1),e.Ge(2,i,1),e.Ge(3,r,1),e.Ie=!0,r.Ie=!0,n.Ie=!0,this.sr=[t,e,r,i,s,n]}Wr(a=1e3,t=1e3){var e=this;let u=!0,r=(e.sr.forEach(t=>{t.Re(),t.De()}),e.ke=e.sr.map(h=>h.Ee.map((r,i)=>{if(h.Ce[i])return null;{var s=[h];let t=r,e=(h.Ce[i]=!0,0);for(;t!=h&&++e<a;){var n=s.at(-1);if(s.push(t),null==t)return null;n=J(t.Ze(n)+1,t.We);t.Ce[n]&&(u=!1),t.Ce[n]=!0,t=t.Ee[n]}return e>=a&&(u=!1),new Set(s).size!=s.length&&(u=!1),new b(s)}})).flat().filter(t=>null!=t),e.sr.every(t=>t.Ce.every(t=>t))||(u=!1),new Set(e.sr.filter(t=>t.Ie)));var i=e.ke.filter(t=>{return new Set(t.sr).size==r.size&&t.sr.every(t=>r.has(t))}),s=(1!=i.length?u=!1:i[0].Ie=!0,e.ke.forEach(t=>t.ze()),e.ke.filter(t=>t.Ie).forEach(t=>t.Le=0),e.sr.filter(t=>t instanceof I));let n=0;for(;!s.every(t=>t.ke.every(t=>0<=t.Le))&&n<t;)s.filter(t=>t.ke.some(t=>t.Le==n)).forEach(t=>{t.ke.filter(t=>t.Le<0).forEach(t=>t.Le=n+1)}),n++;return e.ke.forEach(t=>t.dr()),u}Er(){let i=this;i.Fe=[],i.sr.map(t=>(t.Ve(),t)).filter(t=>t instanceof C).forEach(t=>{t.Ke()});var s=()=>i.sr.filter(t=>t instanceof C).map(t=>[t,t.Qe.reduce((t,e)=>t+Math.min(e,0),0)]).sort((t,e)=>e[1]-t[1]).map(([r])=>r.Qe.map((t,e)=>[r,e,t]).filter(([,,t])=>t<0).map(([t,e])=>[t,e])).flat();let n=!0;for(;0<s().length;){let[e,t]=s()[0];var h=S(e.Y()).filter(t=>!e.Qe.includes(t)).at(n?featureSeeds.handedness:0);n=!1,e.$e(t,h);let r=[e,e.Ee[t]];for(var a=(t=0)=>r.at(-2).Xe(r.at(-1),2+t);a()[0]!=r[0]||a(1)[0]!=r[1];){var u=r.at(-2).Ue(r.at(-2).Ze(r.at(-1))),[o,l]=a();if(null==o)return!1;u=(u+1)%o.Y();if(0<=o.Ue(l))return!1;o.$e(l,u),r.push(o),r.push(a()[0])}i.Fe.push(new y(r))}return i.Fe.forEach((t,r)=>{i.Fe.filter((t,e)=>r<e).forEach(e=>{t.sr.some(t=>e.sr.includes(t));t.Ee.push(e),e.Ee.push(t)})}),!0}Cr(t=1e3){var e=this;e.sr.forEach(t=>t.ze()),e.Ar=-1;let r=e.sr.filter(t=>t.Ie),i=new Set,s=0;for(;i.size!=e.sr.length&&0<--t;)r.forEach(t=>t.Le=s),r.forEach(t=>i.add(t)),s++,r=[...new Set(r.map(t=>t.Ee).flat())].filter(t=>!i.has(t));return e.Ar=Math.max(...e.sr.map(t=>t.Le)),0<t}Nr(t=32,e=!1){return bt(this.sr,!1,t,e)}yr(t=32,e=!1){return bt(this.ke,!1,t,e)}update(){var t=this;return t._r=t.Wr(),t.Sr=t.Er(),t.Pr=t.Cr(),t._r&&t.Sr&&t.Pr}Ir(t,e){var r,i,s,n,h,a,u,o,l,c,f,v,d;return t!=e&&t instanceof I&&e instanceof I&&1==(u=t.ke.filter(t=>e.ke.includes(t))).length&&!u.Ie&&(s=(u=u[0]).sr.indexOf(t),i=(r=u.sr.at(s-1)).Ze(t),n=(s=u.sr.at(s+1)).Ze(t),o=u.sr.indexOf(e),a=(h=u.sr.at(o-1)).Ze(e),o=(u=u.sr.at(o+1)).Ze(e),l=t.Ye(t.name+"_2"),this.sr.push(l),(c=t).name+="_3",f=e.Ye(e.name+"_1"),this.sr.push(f),(v=e).name+="_0",d=new C("iC"),this.sr.push(d),(t.Ie||e.Ie)&&(d.Ie=!0),v.Ge(0,u,o),v.Ge(1,d,0),f.Ge(0,h,a),f.Ge(1,d,1),l.Ge(0,s,n),l.Ge(1,d,2),c.Ge(0,r,i),c.Ge(1,d,3),!0)}valid(){var t=this;return 2<=t.sr.length&&t.sr.every(t=>t.valid())&&new Set(t.sr).size==t.sr.length&&t._r&&t.ke.every(t=>t.valid())&&t.Sr&&t.Fe.every(t=>t.valid())}Mr(){this.sr.forEach(t=>t.Be());let t=this.ke.filter(t=>!t.Ie),e=Math.max(...t.map(t=>t.Le)),r=(t.forEach(t=>{t.weight=t.Ee.reduce((t,e)=>t+e.Le,t.Le+t.Le/(e+1))}),[(t=t.sort((t,e)=>e.weight-t.weight))[0]]),i=new Set(t),s=new Set;for(;0<r.length;){if(!r.every((t,e)=>{return!(0==s.size&&0!=e||!t.Mr([...s])||(e=t,i.delete(e),s.add(e),0))}))return!1;r=[...new Set([...s].map(t=>[t.Ee,t.sr.map(t=>t.ke)]).flat(3))].filter(t=>i.has(t)).sort((t,e)=>e.Le-t.Le).filter((t,e,r)=>t.Le==r[0].Le).map(t=>[t,t.Ee.filter(t=>s.has(t)).length]).sort((t,e)=>e[1]-t[1]).map(([t])=>t)}return!!this.sr.every(t=>t.je())}gr(){return this.Fe.map(t=>t.gr())}get kr(){return new l(this.Gt().flat())}}class F{constructor(t){this.position=null,this.force=null,this.Fr=null,this.nextNode=null,this.Lr=null,this.Tr=t,this.Hr=null,this.Rr=[],this.Te=F.He++}valid(){return null!=this.Tr&&null!=this.position&&this.position instanceof A&&null!=this.Fr&&this.Fr instanceof F&&this.Fr.nextNode==this&&this.Fr.Tr==this.Tr&&null!=this.nextNode&&this.nextNode instanceof F&&this.nextNode.Fr==this&&this.nextNode.Tr==this.Tr}Dr(){this.Rr=[]}Ee(){return[this.Fr,this.nextNode]}Vr(){this.position&&this.nextNode&&this.nextNode.position&&(this.Lr=this.position._t(this.nextNode.position))}zr(){return this.Lr}Br(){return this.Fr?this.Fr.zr():null}jr(){this.Lr=null}Or(){this.Fr&&(this.Fr.nextNode=this),this.nextNode&&(this.nextNode.Fr=this)}qr(){return this.Ee().reduce((t,e)=>t.add(e.position.sub(this.position).normalize()),new A)}Gr(t=+Math.PI,e=.5*Math.PI){var r=this.Fr.position.sub(this.position).normalize(),i=this.nextNode.position.sub(this.position).normalize(),i=u(r.Pt(i),2*Math.PI),t=_((t-i)/e,-1,1),t=m(Math.abs(t))*Math.sign(t),e=r.It(new A(0,0,1),i/2).wt(t);return(new A).add(e)}Zr(t,e,r,i=.5,s=1.5,n=1){let h=e*r,a=e*r*(1-i);return this.Rr.map(([t,e,r])=>{r=m(x(r,a,h,1,0,!0));return[t,e.wt(r*=n)]}).map(([t,e])=>{var r;return t.Tr==this.Tr?(r=v(this.Jr,t.Jr,this.Tr.pathLength),r=m(x(r,a*s,h*s,0,1,!0)),[t,e=e.gt(r)]):[t,e]}).map(([,t])=>t).reduce((t,e)=>t.add(e),new A)}Yr(t,e){t=this.position.z/(t*e/2);return new A(0,0,-t)}Xr(t,e,r,i){null==i&&(i={}),this.force=(new A).add(this.qr().gt(i.Kr??1)).add(this.Zr(t,e,r).gt(i.Qr??1)).add(this.Yr(e,r).gt(i.Ur??1))}$r(){this.force=null}ti(t){let e=1;var r,i;return this.ei&&(r=x(t.St().yt(this.ei.St()),0,-1,0,1,!0),i=M(Math.min(t.wt(),this.ei.wt()),Math.max(t.wt(),this.ei.wt())),e=Math.pow(1-r*i,.5)),this.ei=t.vt(),e}ri(t=1,e=!0){return this.position&&this.force?(t=this.force.gt(t),e=e?this.ti(t):1,t=t.gt(e),this.position=this.position.add(t),t.wt()):0}}F.He=0;class Wt{constructor(){this.sr=[],this.path=null}valid(){return this.sr.every(t=>t.valid())&&this.sr.every((t,e)=>t==this.sr.at(e-1).nextNode&&t==this.sr.at(e+1).Fr)}ii(n,t){let h=this;h.path=new Path(n),h.path.closed=!0,h.path.smooth({type:"geometric"});var e=h.path.segments.map(t=>t.location.offset),t=Math.max(Math.round(h.path.length/t),1);if(ot(h.path,t),h.path.smooth({type:"geometric"}),h.sr=h.path.segments.map(t=>{var e=new F(this);return e.position=new A(t.Zt.x,t.Zt.y),e}),h.sr.forEach((t,e)=>{t.Fr=h.sr.at(e-1),t.nextNode=h.sr.at(e+1)}),3==n[0].length){let s=e;h.sr.forEach((t,e)=>{let r=h.path.segments[e].location.offset;var e=s.map((t,e)=>[v(r,t,h.path.length),e]).sort((t,e)=>t[0]-e[0]),i=(e=[e[0],e[1]])[0][0]+e[1][0];e[0][0]/=i,e[1][0]/=i,t.position.z=m(e[1][0])*n[e[0][1]][2]+m(e[0][0])*n[e[1][1]][2]})}h.si()}ni(t,e){let r=this;r.sr=t.map(t=>{var e=new F(this);return e.position=t.vt(),e}),r.sr.forEach((t,e)=>{t.Fr=r.sr.at(e-1),t.nextNode=r.sr.at(e+1)}),this.hi(e,10),r.si()}ai(t=1,e=.5){let r=-1;for(var i,s=new Set;++r<this.sr.length&&3<this.sr.length;)this.sr.at(r).Vr(),this.sr.at(r).zr()<t*e&&((i=new F(this)).position=this.sr.at(r+0).position.add(this.sr.at(r+1).position).div(2),i.Fr=this.sr.at(r-1),i.nextNode=this.sr.at(r+2),i.Or(),s.delete(this.sr.at(r+0)),s.delete(this.sr.at(r+1)),this.sr[r]=i,this.sr.splice(u(r+1,this.sr.length),1),s.add(this.sr.at(r-1)),s.add(this.sr.at(r+0)));return s}ui(t=1,e=2){let r=-1;for(var i,s=new Set;++r<this.sr.length&&2<=this.sr.length;)this.sr.at(r).Vr(),this.sr.at(r).zr()>t*e&&((i=new F(this)).position=this.sr.at(r+0).position.add(this.sr.at(r+1).position).div(2),i.Fr=this.sr.at(r+0),i.nextNode=this.sr.at(r+1),i.Or(),this.sr.splice(u(r+1,this.sr.length),0,i),s.add(this.sr.at(r+0)),s.add(this.sr.at(r+1)),r++);return s}oi(e,r=1,i=4,s={}){this.sr.forEach(t=>t.Xr(e,r,i,s))}hi(t,e){let r=0;for(;r++<e;)if(0==new Set([...this.ai(t),...this.ui(t)]).size)break;r,this.sr.forEach(t=>t.jr())}li(e=.01,t=1,r=10){var i=this.sr.map(t=>t.ri(e)),s=(this.sr.forEach(t=>t.$r()),i._()/i.length/t),i=Math.max(...i)/t;return this.hi(t,r),[s,i]}si(){null==this.path?(this.path=new E,this.path.closed=!0,this.path.le=!0,this.path.fe="xy"):this.path.Pe(),this.path.Xt=this.sr.map((t,e)=>(t.Hr=e,t.position))}smooth(t,e=3,r=3,i){t=Math.max(Math.round(this.path.length/t),3);ot(this.path,t),lt(this.path,e,r),this.path.reduce()}ci(){return new l(this.path.Xt)}fi(){return this.sr.reduce((t,e)=>t.add(e.position),new l)}}class Et{constructor(){this.vi=[]}valid(){return this.vi.every(t=>t.valid())}di(){return this.vi.map(t=>t.sr.length)._()}ni(t,r){this.vi=t.map(t=>{var e=new Wt;return e.ni(t,r),e})}ii(t,r){this.vi=t.map(t=>{var e=new Wt;return e.ii(t,r),e})}update(t=.001,s=100,n=1,h=.01,e=1e3,r=4,i={}){this.valid();let a=1/0,u=1/0,o=0;for(;a>t*n&&o++<s&&this.di()<e;){var l,c,f,v,d=this.vi.map(t=>t.sr).flat(),M=(d.forEach(t=>t.Dr()),n*r),m=1/Math.sqrt(3);for(let e=0;e<d.length-1;e++)for(let t=e+1;t<d.length;t++)l=d[e],c=d[t],M<=(v=l.position.sub(c.position)).Ft(1)*m||(f=v.wt(),v=v.St(),f<M&&(l.Rr.push([c,v,f]),c.Rr.push([l,v.gt(-1),f])));d.forEach(t=>{t.Jr=t.Tr.path.Ut[t.Hr]}),this.vi.forEach(t=>{t.pathLength=t.path.length}),this.vi.forEach(t=>{t.oi(this.vi,n,r,i)}),this.vi.forEach(t=>{let e=1;var r,i;e=Array.isArray(h)?(i=3<=h.length?h[2]:s,i=_(o/i,0,1),r=4<=h.length?h[3]:1,i=Math.pow(i,r),x(i,0,1,h[0],h[1],!0)):h,[a,u]=t.li(e,n,10),t.si()}),this.valid()}return!(a>t*n&&o>=s||this.di()>=e)}Mi(t){var e=this.vi.map(t=>t.sr).flat().map(t=>t.position.toString(" ")).join("\n"),e=new Blob([e],{type:"text/plain;charset=utf-8"});saveAs(e,t)}ci(){return this.vi.reduce((t,e)=>t.add(e.ci()),new l)}}const Ct=()=>{let network=new Pt;return S(featureSeeds.Y-2).forEach(t=>{let h=M(t,featureSeeds.Y-3);var e=network.ke.filter(t=>!t.Ie);let i=e.map(t=>t.vr).max(),s=e.map(t=>t.Le).max();r=featureSeeds.nt(h).V.O;t=Array.isArray(r)?x(t,r[0][1],r[1][1],r[0][0],r[1][0],!0):r;let a=N.c(n(e,!0).map(t=>{var e=t.vr/i,r=x(t.Le,1,s,1,0,!0);return[t,0+e*featureSeeds.nt(h).V.B+r*featureSeeds.nt(h).V.j]}).sort((t,e)=>e[1]-t[1]).map(([t])=>t),null,t),u=a.sr.filter(t=>t instanceof I);var[r,e]=N.c(n(rt(u.map((t,e)=>[t,e])),!0).map(([[t,e],[r,i]])=>{var s,e=v(e,i,u.length)/Math.floor(u.length/2),i=(i=t.Fe.at(0),s=r.Fe.at(0),null==i||null==s?.5:i!=s?0:(n=(t,e,r)=>{let i=e.sr.indexOf(t),s=r.sr.at(r.sr.indexOf(t)+1);r=e.sr.map((t,e)=>t==s?e:null).filter(t=>null!=t).map(t=>[t,v(t,i,e.sr.length)]).sort((t,e)=>t[1]-e[1]).map(([t])=>t).at(0);return Math.sign(o(i,r,e.sr.length))})(t,i,a)*n(r,s,a)<0?1:.5),n=0+e*featureSeeds.nt(h).q.G+i*featureSeeds.nt(h).q.Z;return[[t,r],n]}).sort((t,e)=>e[1]-t[1]).map(([t])=>t),null,featureSeeds.nt(h).q.O);network.Ir(r,e),network.update()}),network},It=()=>{var network=Ct();return network.valid()&&network.Mr()?network:(network.clear(),It())},T=.15;let kt=1;const H=()=>featureSeeds.X*T*kt,R=()=>{var network=It(),cordSet=new Et,t=(cordSet.ni(network.gr(),T),e?.ACC_START(["cordSet","update()"]),cordSet.update(2*T,1e3,T,[.1,.001,800,1],2e3,4,{Kr:1,Qr:1,Ur:(featureSeeds.nt(0).D+featureSeeds.nt(1).D)/2}));if(e?.ACC_STOP(["cordSet","update()"]),!t)return R();cordSet.vi.forEach(t=>{t.smooth(T/2,3,2),t.smooth(T/4,3,2),t.smooth(T/8,3,2),t.path.reduce()}),cordSet.vi.sort((t,e)=>e.path.length-t.path.length);{let e=cordSet.ci();e.min.z=e.max.z=0;var t=Math.max(e.Bt().x,e.Bt().y),i=(1-2*featureSeeds.ht)/(1+featureSeeds.X*T/t);kt=i/t;let r=(new l).add([new A(featureSeeds.ht+H()/2,featureSeeds.ht+H()/2),new A(1-featureSeeds.ht-H()/2,1-featureSeeds.ht-H()/2)]);cordSet.vi.forEach(t=>{ct(t.path,e,r)})}i=wt(cordSet.vi.map(t=>t.path));return i.length!=featureSeeds.Y?R():(cordSet.mi=i,[network,cordSet])},[network,cordSet]=R();featureSeeds.gi=network.Fe.length,featureSeeds.wi=parseInt(""+(featureSeeds.Y%100).toString().padStart(2,"0")+(featureSeeds.gi%10).toString().padStart(1,"0")+network.yr(16).toString().padStart(65535..toString().length,"0")),featureSeeds.pi=At(network);{let t=N.p().h().step(1e4);t.N("Threads"),[featureSeeds.bi,featureSeeds.yi]=t.c([[1,"1"],[2,"2"],[4,"4"],[8,"8"],[16,"16"]],[.8*(1==network.Fe.length?.75:1)*x(featureSeeds.Y,4,8,.5,1,!0),.12,.12,.1,.06])}const t=new THREE.Scene,Ft=(t.background=new THREE.Color(...featureSeeds.backgroundColor),new THREE.OrthographicCamera(0,1,1,0,.001,100)),D=(Ft.position.z=5,new THREE.WebGLRenderer({antialias:!0})),Lt=(D.setPixelRatio(window.devicePixelRatio),D.setSize(Math.min(window.innerWidth,window.innerHeight),Math.min(window.innerWidth,window.innerHeight)),document.body.appendChild(D.domElement),()=>{let a=[],u=[],o=[],l=[],c=[],f=[],v=H()/2*featureSeeds.$,d=new A(0,0,1),M=0;cordSet.vi.forEach((t,e)=>{let r=0==e?featureSeeds.st:e%2==1?featureSeeds.tt:featureSeeds.rt,i=0==e?featureSeeds.bi:1,s=t.path.Xt,n=t.path.ge,h=t.path.Ne;S(s.length).forEach(t=>{var e=t==s.length-1;a.push(...s.at(t).add(n.at(t).gt(v)).Et(),...s.at(t).add(n.at(t).gt(-v)).Et()),e&&a.push(...s.at(t+1).add(n.at(t+1).gt(v)).Et(),...s.at(t+1).add(n.at(t+1).gt(-v)).Et()),u.push(...d.Et(),...d.Et()),e&&u.push(...d.Et(),...d.Et()),o.push(1,h.at(t)),o.push(0,h.at(t)),e&&(o.push(1,1),o.push(0,1)),l.push(...r),l.push(...r),e&&(l.push(...r),l.push(...r)),c.push(M+2*t+1,M+2*t+2,M+2*t+0),c.push(M+2*t+2,M+2*t+1,M+2*t+3),f.push(i),f.push(i),e&&(f.push(i),f.push(i))}),M=a.length/3});var t=new THREE.BufferGeometry;return t.setIndex(c),t.setAttribute("position",new THREE.Float32BufferAttribute(a,3)),t.setAttribute("normal",new THREE.Float32BufferAttribute(u,3)),t.setAttribute("color",new THREE.Float32BufferAttribute(l,3)),t.setAttribute("uv",new THREE.Float32BufferAttribute(o,2)),t.setAttribute("nthreads",new THREE.Float32BufferAttribute(f,1)),t}),Tt=Lt(),Ht={u_time:{value:0},u_background_color:{value:featureSeeds.backgroundColor},u_margin_fraction:{value:1/featureSeeds.$}},Rt=`
  attribute float nthreads;
  varying vec2 v_uv;
  varying vec3 v_color;
  varying float v_nthreads;
  void main() {
    v_uv = uv;
    v_color = color;
    v_nthreads = nthreads;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,Dt=`
  varying vec2 v_uv;
  varying vec3 v_color;
  varying float v_nthreads;
  // uniform vec2 u_resolution;
  uniform float u_time;
  uniform vec3 u_background_color;
  uniform float u_margin_fraction;
  float mapValue(float value, float start1, float stop1, float start2, float stop2, bool withinBounds) {
    float newValue = (value - start1) / (stop1 - start1) * (stop2 - start2) + start2;
    if (!withinBounds) {
      return newValue;
    } else {
      if (start2 <= stop2) {
        return clamp(newValue, start2, stop2);
      } else {
        return clamp(newValue, stop2, start2);
      }
    }
  }
  void main() {
    // vec2 coord = gl_FragCoord.xy / u_resolution;

    // Calculate params and solidity of this part of the cord
    float param = mapValue(
      v_uv.x,
      0.5 - u_margin_fraction/2.0,
      0.5 + u_margin_fraction/2.0,
      0.0,
      1.0,
      false
    );
    float paramScaled = param*(v_nthreads*2.0-1.0);
    int sectionIndex = int(ceil(paramScaled));
    bool isSolid = param >= 0.0 && param <= 1.0 && sectionIndex%2==1;

    // Mix colors to achieve anti-aliasing
    float mixAmt = isSolid ? ( 
      // 1.0 
      mapValue(abs(mod(paramScaled+0.5,1.0)-0.5),0.0,0.01*(v_nthreads*2.0-1.0),0.0,1.0,true)
    ) : 0.0;
    vec3 mixedColor = mix(u_background_color, v_color, mixAmt);

    gl_FragColor = vec4(mixedColor, 1.0);
  }
`,Vt=new THREE.ShaderMaterial({side:THREE.DoubleSide,vertexShader:Rt,fragmentShader:Dt,uniforms:Ht,vertexColors:!0}),zt=(mesh=new THREE.Mesh(Tt,Vt),t.add(mesh),new THREE.Clock);function Bt(){Ht.u_time.value=zt.getElapsedTime(),requestAnimationFrame(Bt),D.render(t,Ft)}function jt(){D.setSize(Math.min(window.innerWidth,window.innerHeight),Math.min(window.innerWidth,window.innerHeight))}window.addEventListener("resize",jt,!1),Bt();
    //APP_END//
  </script>
  <!-- <script>
    //CALCULATE_FEATURES_BEGIN//
/**
 * Calculate features for the given token data.
 * @param {Object} tokenData
 * @param {string} tokenData.tokenId - Unique identifier of the token on its contract.
 * @param {string} tokenData.hash - Unique hash generated upon minting the token.
 */
function calculateFeatures(tokenData) {

  //FEATURE_SCRIPT_DEPENDENCIES_BEGIN//
  
  //FEATURE_SCRIPT_DEPENDENCIES_END//  

  // ^ DO NOT EDIT
  // ==========================================================================

  let features = {};

  // Calculate your features here, using the existing object `featureSeeds`.

  features['# Crossings'] = featureSeeds.nCrossings;

  features['# Loops'] = featureSeeds.nLoops;

  features['Minimum N-Fold Symmetry'] = featureSeeds.graphSymmetry;

  features['Isomorphic Key'] = featureSeeds.graphHash;

  features['Handedness'] = featureSeeds.handednessName;

  features['Construction Method'] = range(2).map(i => featureSeeds.shapeMode(i).name).filter((i,j,arr) => j==0 || arr[j-1]!=i).join(' + ');

  // 'Weave Type' ? i.e. defined by # loops, twists, etc.

  // features['Cord Width'] = featureSeeds.cordWidthName;

  // features['Cord Width Conformity'] = featureSeeds.cordWidthVariable ? 'Variable' : 'Uniform';

  features['N-Thread Primary Cord'] = featureSeeds.nThreadsName;

  features['Secondary Cord Color'] = featureSeeds.nLoops >= 2 ? featureSeeds.secondaryColorName : 'None';

  features['Tertiary Cord Color'] = featureSeeds.nLoops >= 3 
    && featureSeeds.tertiaryColorName != featureSeeds.secondaryColorName 
    ? featureSeeds.tertiaryColorName 
    : 'None';

  return features;
}
    //CALCULATE_FEATURES_END//
  </script> -->
  <script>
    // Log relevant information to the console.
    console.log("tied up, tied down, let loose, unwound Â© 2023 by Ben Snell is licensed under CC BY-NC 4.0");
    let metadata = {};
    let values = META.split("_").concat(tokenData.hash);
    ['Artist','Title','Version','Hash'].map((key, index) => metadata[key] = values[index]);
    // metadata['Features'] = calculateFeatures(tokenData);
    console.log(metadata);
  </script>
  <script>
    addEventListener("click", (event) => {});
    let lastClickTime = 0;
    ondblclick = () => {
      navigator.clipboard.writeText(window.location.href+'?hash='+tokenData.hash);
    }
    onclick = (event) => {
      let thisClickTime = (new Date()).getTime();
      if ((thisClickTime - lastClickTime) < 600) {
        ondblclick();
      }
      lastClickTime = thisClickTime;
    };
  </script>
</body>

</html>